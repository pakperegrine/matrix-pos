<div class="product-management">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-left">
      <h2 class="page-title">Product Management</h2>
      <p class="page-subtitle">Manage your product inventory and catalog</p>
    </div>
    <button class="btn btn-primary" (click)="openCreateModal()" [disabled]="loading">
      <svg class="btn-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span>Add Product</span>
    </button>
  </div>

  <!-- Table Section -->
  <div class="table-wrapper">
    <app-table
      [columns]="columns"
      [data]="tableData"
      [loading]="loading"
      [selectable]="true"
      (pageChange)="onPageChange($event)"
      (sortChange)="onSort($event)"
      (rowSelect)="onRowSelect($event)"
    ></app-table>
  </div>

  <!-- Product Create/Edit Modal -->
  <app-modal
    [isOpen]="showProductModal"
    [title]="isEditMode ? 'Edit Product' : 'Create New Product'"
    [size]="'lg'"
    [closable]="!savingProduct && !deletingProduct"
    [showFooter]="true"
    (close)="closeProductModal()"
  >
    <div class="modal-content">
      <form class="product-form" (submit)="$event.preventDefault(); saveProduct()">
        <!-- Basic Information Section -->
        <div class="form-section">
          <h4 class="section-title">Basic Information</h4>
          
          <div class="form-row">
            <div class="form-group" [class.has-error]="formErrors['name']">
              <label class="form-label required">Product Name</label>
              <input 
                type="text" 
                class="form-input" 
                [(ngModel)]="currentProduct.name"
                name="name"
                placeholder="e.g. Wireless Mouse"
                maxlength="200"
                [disabled]="savingProduct"
              />
              <span class="error-message" *ngIf="formErrors['name']">{{ formErrors['name'] }}</span>
            </div>
            
            <div class="form-group">
              <label class="form-label">SKU</label>
              <input 
                type="text" 
                class="form-input" 
                [(ngModel)]="currentProduct.sku"
                name="sku"
                placeholder="e.g. WM-001"
                maxlength="100"
                [disabled]="savingProduct"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Barcode</label>
              <input 
                type="text" 
                class="form-input" 
                [(ngModel)]="currentProduct.barcode"
                name="barcode"
                placeholder="e.g. 1234567890123"
                maxlength="100"
                [disabled]="savingProduct"
              />
            </div>
          </div>
        </div>

        <!-- Pricing Section -->
        <div class="form-section">
          <h4 class="section-title">Pricing</h4>
          
          <div class="form-row">
            <div class="form-group" [class.has-error]="formErrors['price']">
              <label class="form-label required">Sale Price</label>
              <div class="input-group">
                <span class="input-prefix">$</span>
                <input 
                  type="number" 
                  class="form-input with-prefix" 
                  [(ngModel)]="currentProduct.price"
                  name="price"
                  placeholder="0.00"
                  step="0.01"
                  min="0"
                  [disabled]="savingProduct"
                />
              </div>
              <span class="error-message" *ngIf="formErrors['price']">{{ formErrors['price'] }}</span>
            </div>
            
            <div class="form-group" [class.has-error]="formErrors['cost']">
              <label class="form-label">Cost Price</label>
              <div class="input-group">
                <span class="input-prefix">$</span>
                <input 
                  type="number" 
                  class="form-input with-prefix" 
                  [(ngModel)]="currentProduct.cost"
                  name="cost"
                  placeholder="0.00"
                  step="0.01"
                  min="0"
                  [disabled]="savingProduct"
                />
              </div>
              <span class="error-message" *ngIf="formErrors['cost']">{{ formErrors['cost'] }}</span>
              <span class="help-text">Used for profit calculation</span>
            </div>
          </div>
        </div>

        <!-- Classification Section -->
        <div class="form-section">
          <h4 class="section-title">Classification</h4>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Category</label>
              <select 
                class="form-select" 
                [(ngModel)]="currentProduct.category_id"
                name="category_id"
                [disabled]="savingProduct"
              >
                <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">Unit of Measure</label>
              <select 
                class="form-select" 
                [(ngModel)]="currentProduct.unit_id"
                name="unit_id"
                [disabled]="savingProduct"
              >
                <option *ngFor="let unit of units" [value]="unit.id">{{ unit.name }}</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Inventory Settings Section -->
        <div class="form-section">
          <h4 class="section-title">Inventory Settings</h4>
          
          <div class="form-row checkbox-row">
            <div class="form-group checkbox-group">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  [(ngModel)]="currentProduct.track_inventory"
                  name="track_inventory"
                  [disabled]="savingProduct"
                />
                <span class="checkbox-text">
                  <strong>Track Inventory</strong>
                  <small>Monitor stock levels for this product</small>
                </span>
              </label>
            </div>
            
            <div class="form-group checkbox-group">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  [checked]="currentProduct.is_active === 1"
                  (change)="currentProduct.is_active = $any($event.target).checked ? 1 : 0"
                  name="is_active"
                  [disabled]="savingProduct"
                />
                <span class="checkbox-text">
                  <strong>Active</strong>
                  <small>Product is available for sale</small>
                </span>
              </label>
            </div>
          </div>

          <div class="form-row checkbox-row" *ngIf="currentProduct.track_inventory">
            <div class="form-group checkbox-group">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  [(ngModel)]="currentProduct.allow_negative_stock"
                  name="allow_negative_stock"
                  [disabled]="savingProduct"
                />
                <span class="checkbox-text">
                  <strong>Allow Negative Stock</strong>
                  <small>Permit sales when out of stock</small>
                </span>
              </label>
            </div>
          </div>
        </div>
      </form>
    </div>

    <!-- Modal Footer -->
    <div footer class="modal-footer-actions">
      <button 
        type="button"
        class="btn btn-secondary" 
        (click)="closeProductModal()"
        [disabled]="savingProduct || deletingProduct"
      >
        Cancel
      </button>
      
      <button 
        *ngIf="isEditMode" 
        type="button"
        class="btn btn-danger" 
        (click)="deleteProduct()"
        [disabled]="savingProduct || deletingProduct"
      >
        <span *ngIf="!deletingProduct">Delete</span>
        <span *ngIf="deletingProduct" class="btn-loading">Deleting...</span>
      </button>
      
      <button 
        type="submit"
        class="btn btn-primary" 
        (click)="saveProduct()"
        [disabled]="savingProduct || deletingProduct"
      >
        <span *ngIf="!savingProduct">{{ isEditMode ? 'Update Product' : 'Create Product' }}</span>
        <span *ngIf="savingProduct" class="btn-loading">{{ isEditMode ? 'Updating...' : 'Creating...' }}</span>
      </button>
    </div>
  </app-modal>
</div>
