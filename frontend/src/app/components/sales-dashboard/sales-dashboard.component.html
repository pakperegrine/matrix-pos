<div class="sales-dashboard">
  <div class="dashboard-header">
    <div class="header-left">
      <h2 class="page-title">Sales Dashboard</h2>
      <p class="page-subtitle">Real-time sales analytics and insights</p>
    </div>
    <button class="btn btn-primary" (click)="exportReport()">
      <span class="btn-icon">ðŸ“Š</span>
      <span>Export Report</span>
    </button>
  </div>

  <!-- Summary Cards -->
  <div class="summary-cards">
    <div class="summary-card">
      <div class="card-icon" style="background: #dbeafe;">
        <span style="color: #3b82f6;">ðŸ’°</span>
      </div>
      <div class="card-content">
        <div class="card-label">Today's Sales</div>
        <div class="card-value">{{ formatCurrency(summary.todaySales) }}</div>
        <div class="card-meta">{{ summary.todayTransactions }} transactions</div>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-icon" style="background: #d1fae5;">
        <span style="color: #10b981;">ðŸ“ˆ</span>
      </div>
      <div class="card-content">
        <div class="card-label">Today's Profit</div>
        <div class="card-value">{{ formatCurrency(summary.todayProfit) }}</div>
        <div class="card-meta">
          {{ summary.todaySales > 0 ? ((summary.todayProfit / summary.todaySales) * 100).toFixed(1) : 0 }}% margin
        </div>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-icon" style="background: #fef3c7;">
        <span style="color: #f59e0b;">ðŸ“…</span>
      </div>
      <div class="card-content">
        <div class="card-label">This Month</div>
        <div class="card-value">{{ formatCurrency(summary.monthSales) }}</div>
        <div class="card-meta">{{ summary.monthTransactions }} transactions</div>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-icon" style="background: #e0e7ff;">
        <span style="color: #6366f1;">ðŸ’Ž</span>
      </div>
      <div class="card-content">
        <div class="card-label">Monthly Profit</div>
        <div class="card-value">{{ formatCurrency(summary.monthProfit) }}</div>
        <div class="card-meta">
          {{ summary.monthSales > 0 ? ((summary.monthProfit / summary.monthSales) * 100).toFixed(1) : 0 }}% margin
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-section">
    <div class="chart-card">
      <div class="chart-header">
        <h3 class="chart-title">Sales Trends</h3>
        <div class="period-selector">
          <button 
            class="period-btn" 
            [class.active]="period === 'today'"
            (click)="changePeriod('today')">
            Today
          </button>
          <button 
            class="period-btn" 
            [class.active]="period === 'week'"
            (click)="changePeriod('week')">
            Week
          </button>
          <button 
            class="period-btn" 
            [class.active]="period === 'month'"
            (click)="changePeriod('month')">
            Month
          </button>
        </div>
      </div>
      
      <div class="chart-container">
        <div class="chart-placeholder" *ngIf="!loading">
          <svg viewBox="0 0 800 300" class="line-chart">
            <!-- Sales Line -->
            <polyline
              [attr.points]="getPolylinePoints(chartData.sales, 800, 250, 50)"
              fill="none"
              stroke="#3b82f6"
              stroke-width="3"
            />
            <!-- Profit Line -->
            <polyline
              [attr.points]="getPolylinePoints(chartData.profit, 800, 250, 50)"
              fill="none"
              stroke="#10b981"
              stroke-width="3"
              stroke-dasharray="5,5"
            />
            
            <!-- X-axis labels -->
            <g *ngFor="let label of chartData.labels; let i = index">
              <text
                [attr.x]="(800 / chartData.labels.length) * i + 40"
                [attr.y]="280"
                font-size="12"
                fill="#6b7280"
                text-anchor="middle"
              >
                {{ label }}
              </text>
            </g>
          </svg>
          
          <div class="chart-legend">
            <div class="legend-item">
              <span class="legend-color" style="background: #3b82f6;"></span>
              <span>Sales</span>
            </div>
            <div class="legend-item">
              <span class="legend-color dashed" style="background: #10b981;"></span>
              <span>Profit</span>
            </div>
          </div>
        </div>
        
        <div class="chart-loading" *ngIf="loading">
          <div class="loader">Loading chart data...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Data Tables -->
  <div class="data-section">
    <!-- Top Products -->
    <div class="data-card">
      <div class="data-header">
        <h3 class="data-title">Top Products</h3>
        <span class="data-badge">{{ topProducts.length }} items</span>
      </div>
      <div class="data-table">
        <table>
          <thead>
            <tr>
              <th>Product</th>
              <th class="right">Qty</th>
              <th class="right">Sales</th>
              <th class="right">Profit</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let product of topProducts; let i = index">
              <td>
                <div class="product-cell">
                  <span class="rank">{{ i + 1 }}</span>
                  <span>{{ product.product_name }}</span>
                </div>
              </td>
              <td class="right">{{ product.total_quantity }}</td>
              <td class="right">{{ formatCurrency(product.total_sales) }}</td>
              <td class="right profit">{{ formatCurrency(product.total_profit) }}</td>
            </tr>
            <tr *ngIf="topProducts.length === 0">
              <td colspan="4" class="empty">No data available</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Recent Transactions -->
    <div class="data-card">
      <div class="data-header">
        <h3 class="data-title">Recent Transactions</h3>
        <span class="data-badge">Last 10</span>
      </div>
      <div class="data-table">
        <table>
          <thead>
            <tr>
              <th>Invoice</th>
              <th>Date</th>
              <th class="right">Amount</th>
              <th>Payment</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let txn of recentTransactions">
              <td><strong>{{ txn.invoice_no }}</strong></td>
              <td class="date">{{ formatDate(txn.created_at) }}</td>
              <td class="right amount">{{ formatCurrency(txn.total_amount) }}</td>
              <td>
                <span class="payment-badge" [class]="'payment-' + txn.payment_method">
                  {{ txn.payment_method === 'cash' ? 'ðŸ’µ Cash' : 'ðŸ’³ Card' }}
                </span>
              </td>
            </tr>
            <tr *ngIf="recentTransactions.length === 0">
              <td colspan="4" class="empty">No transactions yet</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
